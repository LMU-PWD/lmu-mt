<link rel="import" href="../shared/shared-styles.html">

<dom-module id="navigation-bar">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
            .nav-container {
                border-bottom: #BBB solid 3px;
                background: var(--paper-blue-grey-100);
                height: 70px;
            }
            .configuration{
                float: left;
            }
            .notification{
                float:right;
            }
            .icon{
                display: block;
                margin: auto;
                /*padding-top: 10px;*/
                width: 100px;
                z-index: 1;
            }
            paper-icon-button {
                /*position: relative;*/
                margin: 5%;
                color: var(--paper-blue-grey-900);
            }
        </style>

        <api-request
                headers="[[ ajax.headers ]]"
                method="[[ ajax.method ]]"
                endpoint="[[ ajax.endpoint ]]"
                response="{{ apiResponse }}"></api-request>

        <app-toolbar class="nav-container">
            <!--<div class="configuration nav-block">-->
                <!--<paper-icon-button icon="icons:menu"></paper-icon-button>-->
            <!--</div>-->
            <div class="configuration nav-block">
                <paper-icon-button icon="icons:exit-to-app" on-tap="_fireLogoutRequest"></paper-icon-button>
            </div>
            <div class="icon nav-block">
                <img src="../../images/mt.svg">
            </div>
            <div class="notification  nav-block">
                <paper-icon-button class="mobile-and-tablet-only" icon="social:notifications" on-click="toggleNotificationList"></paper-icon-button>
            </div>
        </app-toolbar>

    </template>

    <script>
        Polymer({

            is: 'navigation-bar',

            properties: {

                apiResponse: {
                    type: String,
                    reflectToAttribute: false,
                    observer: '_apiResponseChanged'
                },

                accessToken: {
                    type: String,
                    notify: true
                },

                group: {
                    type: Object,
                    notify: true,
                    value: {}
                },

                loggedIn: {
                    type: Boolean,
                    notify: true
                },

                userId: {
                    type: String,
                    notify: true
                },

                user: {
                    type: Object,
                    notify: true,
                    value: {}
                },

                show: {
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },

            toggleNotificationList: function() {

                var screenwidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;

                if (screenwidth < 1023)
                    this.show = !this.show;
            },

            /**
             * Callback fired when logout button is pressed. Sets a property
             * `ajax` containing information for logout API call
             * @private
             */
            _fireLogoutRequest: function () {

                if (this.loggedIn) {
                    this.ajax = {
                        headers: {
                            'Authorization': this.accessToken
                        },
                        method: 'POST',
                        endpoint: '/platformusers/logout'
                    }
                }
            },

            _apiResponseChanged: function (response) {

                if (response.type == 'response') {

                    document.cookie = 'mt-api-accesstoken=; expires=Thu, 01 Jan 1970 00:00:00 UTC';
                    document.cookie = 'mt-api-userid=; expires=Thu, 01 Jan 1970 00:00:00 UTC';

                    this.set('accessToken', '');
                    this.set('userId', '');
                    this.set('loggedIn', false);
                    this.set('user', {});
                    this.set('group', {});

                }

            }
        });
    </script>
</dom-module>
