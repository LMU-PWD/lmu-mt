<!--Localization Imports-->
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">
<link rel="import" href="../services/my-localize-behavior.html">

<link rel="import" href="lab-detail-content-element.html">
<dom-module id="labtype-detail-view">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                #margin-top: 20px;
                padding: 3%;
                text-align: left;
            }
            paper-button{
                margin: 2%;
            }

            /*Phone*/
            @media screen and (max-width: 767px) {
            }
            /*Tablet*/
            @media screen and (min-width: 768px) and (max-width: 1023px) {

            }
            /*Desktop*/
            @media screen and (min-width: 1024px) {

            }
        </style>

        <api-request
                headers="[[ ajax_save_registration_open.headers ]]"
                method="[[ ajax_save_registration_open.method ]]"
                body="[[ ajax_save_registration_open.body ]]"
                endpoint="[[ ajax_save_registration_open.endpoint ]]"
                on-api-response="_responseFromPostingRegistrationOpen"></api-request>
        <api-request
                headers="[[ ajax_save_labtype.headers ]]"
                method="[[  ajax_save_labtype.method ]]"
                body="[[  ajax_save_labtype.body ]]"
                endpoint="[[  ajax_save_labtype.endpoint ]]"
                on-api-response="_responseFromPostingRegistrationOpen"></api-request>

        <paper-button raised class="studentsRegistrationButton" on-tap="_handleStudentButtonClick">
            <template is="dom-if" if="[[labType.registration_open]]">
                [[localize('practicals-admin close_registration')]]
            </template>
            <template is="dom-if" if="[[!labType.registration_open]]">
                [[localize('practicals-admin open_registration')]]
            </template>
        </paper-button>
        <lab-detail-content-element
                text="[[localize('practicals-admin-labtype text1')]]" data="[[labType.registration_deadline]]" input="{{ dateInput }}"
                is-date-from-parent="true" is-id-from-parent="false" is-editor-from-parent="false"></lab-detail-content-element>
        <lab-detail-content-element
                text="[[localize('practicals-admin-labtype text2')]]" data="[[labType.registration_deadline_tutors]]" input="{{ dateTutorInput }}"
                is-date-from-parent="true" is-id-from-parent="false" is-editor-from-parent="false"></lab-detail-content-element>
        <lab-detail-content-element
                text="[[localize('practicals-admin-labtype text3')]]" data="[[labType.description_student]]"  input="{{ descriptionStudentInput }}"
                is-date-from-parent="false" is-id-from-parent="false" is-editor-from-parent="true"></lab-detail-content-element>
        <lab-detail-content-element
                text="[[localize('practicals-admin-labtype text4')]]" data="[[labType.description_tutor]]"  input="{{ descriptionTutorInput }}"
                is-date-from-parent="false" is-id-from-parent="false" is-editor-from-parent="true"></lab-detail-content-element>

        <template is="dom-if" if="[[showSaveButton]]">
            <paper-button raised class="button" on-tap="_handleSaveButtonClick">
                <iron-icon icon="save" ></iron-icon>[[localize('c_button_save')]]
            </paper-button>
        </template>
        <iron-signals on-iron-signal-language="changeLanguage"></iron-signals>
    </template>

    <script>
        Polymer({
            is: 'labtype-detail-view',
            properties: {
                accessToken: {
                    type: String,
                    notify: true
                },
                dateInput: {
                    type: String,
                    observer: "_dateChanged"
                },
                dateTutorInput: {
                    type: String,
                    observer: "_dateTutorChanged"
                },
                descriptionStudentInput: {
                    type: String,
                    observer: "_descriptionStudentChanged"
                },
                descriptionTutorInput: {
                    type: String,
                    observer: "_descriptionTutorChanged"
                },
                labType: Object,
                labTypeFromApi: {
                    type: Object,
                    observer: "_labTypeChanged"
                },
                showSaveButton:{
                    type: Boolean,
                    value: false
                }
            },
            behaviors: [
                Polymer.MyLocalizeBehavior
            ],
            ready: function () {
                //console.log(this.accessToken);
                //console.log(this.labTypeFromApi);
            },
            /**
             * Handle changes of
             * @param e - Event Variable
             * @private
             */
            _dateChanged: function(e){
                //console.log(this.dateInput);
                this.set('labType.registration_deadline', this.dateInput);
                this.set('showSaveButton', true);
            },
            /**
             * Handle changes of
             * @param e - Event Variable
             * @private
             */
            _dateTutorChanged: function(e){
                //console.log(this.dateTutorInput);
                this.set('labType.registration_deadline_tutors', this.dateTutorInput);
                this.set('showSaveButton', true);
            },

            /** Handle changes of
            * @param e - Event Variable
            * @private
            */
            _descriptionTutorChanged: function(e){
                //console.log(this.descriptionTutorInput);
                this.set('labType.description_tutor', this.descriptionTutorInput);
                this.set('showSaveButton', true);
            },
            /** Handle changes of
             * @param e - Event Variable
             * @private
             */
            _descriptionStudentChanged: function(e){
                //console.log(this.descriptionStudentInput);
                this.set('labType.description_student', this.descriptionStudentInput);
                this.set('showSaveButton', true);
            },
            /**
             * Handle click on Student Button to Post registration_open on API
             * @param e - Event Variable
             * @private
             */
            _handleSaveButtonClick: function(){
                //console.log(event.detail);
                //Post LabType-Changes in API
                console.log(this.labType);
                if (this.labType.id) {
                    this.ajax_save_labtype = {
                        headers: {
                            Authorization: this.accessToken
                        },
                        body: {
                            description_student: this.labType.description_student,
                            description_tutor: this.labType.description_tutor,
                            registration_deadline: this.labType.registration_deadline.toString(),
                            registration_deadline_tutors: this.labType.registration_deadline_tutors.toString()
                        },
                        method: 'PATCH',
                        endpoint: '/labtypes/' + this.labType.id
                    };
                    //console.log(this.ajax_save_labtype);
                }
                else {
                    console.log("Error: LabId is wrong: ");
                    console.log(this.labToSet.id);
                }

                this.set('showSaveButton', false);
            },

            /**
             * Handle click on Student Button to Post registration_open on API
             * @private
             */
            _handleStudentButtonClick: function(){
                if(this.labType.registration_open) {
                    this.set('labType.registration_open', false);
                    this.ajax_save_registration_open = {
                        headers: {
                            Authorization: this.accessToken
                        },
                        body: {
                            registration_open: this.labType.registration_open
                        },
                        method: 'PUT',
                        endpoint: '/labtypes/' + this.labType.id
                    };
                }
                else {
                    this.set('labType.registration_open', true);
                    this.ajax_save_registration_open = {
                        headers: {
                            Authorization: this.accessToken
                        },
                        body: {
                            registration_open: this.labType.registration_open
                        },
                        method: 'PUT',
                        endpoint: '/labtypes/' + this.labType.id
                    };
                }
                //console.log(this.ajax_save_registration_open);
            },

            /**
             * Handle chages of lab-Object
             * @param e - Event Variable
             * @private
             */
            _labTypeChanged: function(e){
                //console.log(this.labTypeFromApi);
                this.set('labType', this.labTypeFromApi);
                this.set('labType.registration_deadline', new Date(this.labTypeFromApi.registration_deadline));
                this.set('labType.registration_deadline_tutors', new Date(this.labTypeFromApi.registration_deadline_tutors));
            },

            /**
             * Handle response from api-request whith ajax_groups
             * @param e - Event Variable
             * @private
             */
            _responseFromPostingRegistrationOpen: function(e){
                console.log(e.detail);
            },

            /**
             * Handle response from api-request to save changed lab data
             * @param e - Event Variable
             * @private
             */
            _responseFromPostingLabtype: function(e){
                console.log(e);
            }
        });
    </script>
</dom-module>
