<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="date-creator.html">
<link rel="import" href="calculate-timeslots.html">
<link rel="import" href="../shared/shared-styles.html">

<dom-module id="practical-date-detail">
    <template>
        <style include="shared-styles">
            :host{

            }
            .dateselector{
                text-align: center;
                width: 100%;
            }
            .datecreator{
                display:inline-block;
                margin:0;
                height: auto;
                vertical-align:top;
            }
            /*Phone*/
            @media screen and (max-width: 767px) {
                .datecreator{
                    width: 100%;
                }
            }
            /*Tablet*/
            @media screen and (min-width: 768px) and (max-width: 1023px) {
                .datecreator{
                    min-width: 400px;
                    width: 49%;

                }
            }
            /*Desktop*/
            @media screen and (min-width: 1024px) {
                .datecreator{
                    min-width: 400px;
                    width: 24%;
                }
            }
        </style>
        <calculate-timeslots></calculate-timeslots>
        <!-- Checking for PracticalDate to know, if the date is already chosen-->
        <template is="dom-if" if="[[!practical_date]]">
            <div class="dateselector">
                <template is="dom-repeat" items="[[timeslots]]" as="slots">
                    <date-creator timeslots="[[slots]]" priority="[[priority]]" class="datecreator"
                                  on-priority-click="_handlePriorityClick" on-date-click="_handleDateClick"></date-creator>
                </template>
            </div>
        </template>
        <template is="dom-if" if="[[practical_date]]">
            <div class="dateshower">
                Dein Praktikumstermin ist am [[practical_date_string]]
            </div>
        </template>
    </template>
    <script>
        Polymer({
            is: 'practical-date-detail',
            properties: {
                type:{
                    type: String,
                    notify: true,
                    value: ""
                },
                practical_date: {
                    type: Date,
                    notify: true,
                    observer: '_practicalDateChanged'
                },
                practical_date_string: {
                    type: String,
                    value: "",
                    notify: true

                },
                timeslots:{
                    type: Array,
                    value: []
                },
                priority:{
                    type: Number,
                    value: 5
                },
                priorities:{
                    type: Array,
                    value: []
                },
                chosenslots:{
                    type: Array,
                    value: []
                }
            },

            ready: function() {
                console.log(this.practical_date);
                if(this.practical_date != null){
                    this.practical_date_string = this._getDateString(this.practical_date);
                    console.log(this.practical_date_string);
                }
                for (i = 0; i < this.priority; i++) {
                    this.priorities[i]=i+1;
                }
            },
            /**
             *  Handle practicalChanged Event; Variable practical_date changed
             */
            _practicalDateChanged: function(){
                if(this.practical_date != null){
                    this.practical_date_string = this._getDateString(this.practical_date);
                }
            },

            /**
             * Creates string from the given date
             * @param {String} date - date that will be transformed to String
             */
            _getDateString: function(date){
                var datestring = "";
                switch(date.getDay()){
                    case 0:
                        datestring = "Sonntag, den ";
                        break;
                    case 1:
                        datestring = "Montag, den ";
                        break;
                    case 2:
                        datestring = "Dienstag, den ";
                        break;
                    case 3:
                        datestring = "Mittwoch, den ";
                        break;
                    case 4:
                        datestring = "Donnerstag, den ";
                        break;
                    case 5:
                        datestring = "Freitag, den ";
                        break;
                    case 6:
                        datestring = "Samstag, den ";
                        break;
                }
                var hours = date.getHours();
                var minutes = date.getMinutes();
                if(hours<10){
                   hours = "0"+hours;
                }
                if(minutes<10){
                   minutes = "0"+minutes;
                }
                datestring = datestring+date.getDate()+"."+date.getMonth()+"."+date.getFullYear()+
                        " um "+hours+":"+minutes+" Uhr";
                return datestring;
            },

            /**
             * Handle date click from Child (date-creator)
             * Update child priorities-Array
             * @param e - Event Variable
             * @private
             */
            _handleDateClick: function(e){
                e.target.priorities = this.priorities;
            },

            /**
             * Handle priority click from Child (date-creator)
             * @param e - Event Variable
             * @private
             */
            _handlePriorityClick: function(e){
                this.chosenslots[e.target.chosenpriority-1]= e.target.chosenslot;
                //console.log(this.chosenslots);
                this.priorities[e.target.chosenpriority-1] = 0;
            }
        });
    </script>
</dom-module>