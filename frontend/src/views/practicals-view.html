<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../shared/shared-styles.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../components/practicals-students-date-detail.html">

<!--Localization Imports-->
<link rel="import" href="../../bower_components/iron-signals/iron-signals.html">
<link rel="import" href="../services/my-localize-behavior.html">


<dom-module id="practicals-view">
    <template>
        <style include="shared-styles">
            :host {
              #display: block;
            }
            .page{
              #border-radius: 25px;
              margin: 24px;
              background-color: var(--paper-blue-grey-100);
              color: var(--paper-blue-grey-900);
            }
            .tabheader{
              background-color: var(--paper-blue-grey-900);
              font-size: 120%;
              #border-radius: 25px 25px 0px 0px;
              overflow: hidden;
              height: 5vh;
            }
            .tabheaderbuttons{
              color: var(--paper-blue-grey-50);
              text-align: center;
            }
            .backbutton{
              width: 70px;
              --paper-icon-button-ink-color:var(--paper-blue-grey-300);
              padding-right: 30px;
            }
            .firsttab{
              padding-left: 25px;
            }
            paper-tab{
              --paper-tab-ink:var(--paper-blue-grey-100);
              font-weight: 300;
            }
            paper-tab.iron-selected {
              color: var(--paper-blue-grey-900);
              background-color: var(--paper-blue-grey-100);
            }
            .icon{
              position: absolute;
              margin-left: 40px;
              margin-top: -5px;
              width: 64px;
              height: 64px;
              width: 6vh;
              height: 6vh;
              border-radius: 50%;
              background-color: var(--paper-blue-grey-100);
              border:  3px solid var(--paper-blue-grey-900);
              z-index: 1;
            }
            .content{
              padding: 10px;
            }
        </style>

        <api-request
                headers="[[ ajax_labTypes.headers ]]"
                method="[[ ajax_labTypes.method ]]"
                endpoint="[[ ajax_labTypes.endpoint ]]"
                on-api-response="_handleLabTypesRequest"></api-request>

        <api-request
                headers="[[ ajax_labs.headers ]]"
                method="[[ ajax_labs.method ]]"
                endpoint="[[ ajax_labs.endpoint ]]"
                on-api-response="_handleAllLabsRequest"></api-request>


        <!--on user set (changed)-->
        <!--API request labtype filter: type & semesterid-->
            <!--API request all labs filter labtypeid -->

        <!--on group set (changed)-->
            <!--API request groups priorities-->
            <!--API request groups labs-->


        <div class="page">
            <img class="icon" src="../../images/[[name]].svg" z-index="1">
            <paper-tabs selected="{{selectedTab}}" class="tabheader" no-slide>
                <paper-tab class="tabheaderbuttons">Allgemein</paper-tab>
                <paper-tab class="tabheaderbuttons">Termine</paper-tab>
            </paper-tabs>
            <div class="content">
                <h1>[[type]] Praktikum</h1>
                <iron-pages selected="[[selectedTab]]">
                    <div>
                        <h1>Informationen</h1>
                        <template is="dom-if" if="[[user.isTutor]]">
                            <p>[[labType.description_tutor]]</p>
                        </template>
                        <template is="dom-if" if="[[user.isStudent]]">
                            <p>[[labType.description_student]]</p>
                        </template>
                    </div>
                    <div>
                        <h1>Terminauswahl</h1>
                        <!--practicals-students-date-detail id="detailView"
                                                         group="{{ group }}"
                                                         user="{{ user }}"
                                                         lab-type="[[labType]]"
                                                         lab-data="[[labData]]"
                                                         all-labs="[[allLabs]]"
                                                         access-token="{{ accessToken }}"></practicals-students-date-detail-->
                    </div>
                </iron-pages>
            </div>
        </div>
    </template>

    <script>
        Polymer({
            is: 'practicals-view',
            properties: {
                name: String,
                accessToken: {
                    type: String,
                    notify: true
                },
                practical_date:{
                    type: Date,
                    notify: true
                },
                route: {
                    type: Object,
                    notify: true
                },
                selectedTab:{
                    type: String,
                    value: "0"
                },
                type:{
                    type: String,
                    notify: true,
                    value: ""
                },
                isReady: {
                    type: Boolean,
                    value: false
                },
                user: {
                    type: Object,
                    observer: '_userChanged'
                },
                group: {
                    type: Object,
                    observer: '_groupChanged'
                },
                /*Paths:• Lab (final lab from group object)
                *       • Priorities (groups )    */
                labData: Object,

                /*Holding information about the labType (infotext, deadlines, ect.. )*/
                labType: Object
            },

            _groupChanged: function (detail) {
                console.log(detail);
            },
            _userChanged: function (detail) {
                console.log(detail);

                this.ajax_labTypes = {
                    headers: {
                        Authorization: this.accessToken,
                        filter: '{"where":{"semesterId":"'+this.user.semesterId+'","type_str":"'+this.type+'"}}'
                    },
                    method: 'GET',
                    endpoint: '/Labtypes'
                };
            },
            _handleLabTypesRequest: function (response) {
                this.set('labType',response.detail[0]);
                console.log(this.labType);

                this.ajax_labs = {
                    headers: {
                        Authorization: this.accessToken,
                        filter: '{"where":{"semesterId":"'+this.user.semesterId+'","labTypeId":"'+this.labType.id+'"}}'
                    },
                    method: 'GET',
                    endpoint: '/Labs'
                };
            },
            _handleAllLabsRequest: function (response) {
                this.set('allLabs',response.detail);
                console.log(this.allLabs);
            }
        });
    </script>
</dom-module>
